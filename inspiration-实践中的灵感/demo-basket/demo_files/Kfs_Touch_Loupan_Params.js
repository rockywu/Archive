APF.Namespace.register("kfstouch.global.component");(function(b,c,a){c.Phone=function(d){var e={tel:"#g-tel",telview:"#g-telview",viewopenClass:"g-telopen",shodow:"#g-shodow",newtel:"#g-newtel",type:0,telinfo:"#g-telinfo",pagetype:"loupan"};this.ops={};this.ele={};b.extend(this.ops,e,d||{});this.os=this.getOs();this.guid=J.site.createGuid();this.timeSojStatus=false;this.tag=0;this.init()};c.Phone.prototype={constructor:c.phone,init:function(){var h=this,f,g;this.ele.tel=b(this.ops.tel);this.ele.telview=b(this.ops.telview);this.ele.shodow=b(this.ops.shodow);this.ele.newtel=b(this.ops.newtel);this.ele.telinfo=b(this.ops.telinfo);this.phoneNum=this.ele.tel.attr("data-phone");f=b("body").height();g=b(window).height();if(f<g){b("body").css("min-height",g)}if(this.ops.type===0){h.showTel()}else{b(document).on("touchstart",function(){h.showTel()})}this.ele.tel.click(function(i){h.tag=b(this).data("tag")||0;h.telClick(i)});this.ele.telview.click(b.proxy(this.hideTelView,this));this.ele.shodow.click(b.proxy(this.hideTelView,this));this.ele.newtel.click(b.proxy(this.hideTelView,this));this.bindBooktel();if(this.ops.select){try{var e=this.ops.select.split(",");b.each(e,function(i,j){b(j).click(function(k){h.tag=b(this).data("tag")||0;h.telClick(k)})})}catch(d){console.log(d)}}},telClick:function(d){d.stopPropagation();d.preventDefault();if(this.os.android){this.ele.newtel.css("display","-webkit-box");this.showShodow();this.ele.telview.addClass(this.ops.viewopenClass);T.trackEvent("track_"+this.ops.pagetype+"_phone_animation")}else{this.timeSojStatus=true;this.addPhoneEvent();T.trackEvent(this.ele.tel.attr("data-track-soj"),'{"puid":"'+this.guid+'","phone":"'+this.phoneNum+'","tag":"'+this.tag+'"}');location.href=this.ele.tel.attr("href")}},hideShodow:function(d){var e=this;setTimeout(function(){e.ele.shodow.hide()},50)},showShodow:function(){this.ele.shodow.css("height",b("body").height());this.ele.shodow.show()},hideTelView:function(d){var f=this,e=d.target;d.stopPropagation();this.ele.telview.removeClass(this.ops.viewopenClass);this.hideShodow();setTimeout(function(){f.ele.newtel.hide();f.ele.tel.css("display","-webkit-box")},400);if(e.nodeName.toLowerCase()=="a"){this.timeSojStatus=true;this.addPhoneEvent();T.trackEvent(this.ele.tel.attr("data-track-soj"),'{"puid":"'+this.guid+'","phone":"'+this.phoneNum+'","tag":"'+this.tag+'"}')}else{T.trackEvent("track_"+this.ops.pagetype+"_phone_close")}},getOs:function(){var f=navigator.userAgent,h={},e=f.match(/(Android);?[\s\/]+([\d.]+)?/),d=f.match(/(iPad).*OS\s([\d_]+)/),g=f.match(/(iPod)(.*OS\s([\d_]+))?/),i=!d&&f.match(/(iPhone\sOS)\s([\d_]+)/);if(e){h.android=true}if(i&&!g){h.ios=h.iphone=true}if(d){h.ios=h.ipad=true}if(g){h.ios=h.ipod=true}return h},addPhoneEvent:function(){document.addEventListener("touchstart",this.sendTimeSoj,false);window.addEventListener("popstate",this.sendTimeSoj,this.phoneNum,this.guid)},showTel:function(){this.ele.telinfo.css("display","-webkit-box")},sendTimeSoj:function(){if(!this.timeSojStatus){return}this.timeSojStatus=false;var d=(new Date()).getTime();T.trackEvent(this.ele.tel.attr("data-track-soj"),'{"pt":"'+d+'","puid":"'+tGuid+'","phone":"'+tphone+'","tag":"'+this.tag+'"}',document.location.href,T.treferrer);document.removeEventListener("touchstart",trackPhoneTime);window.removeEventListener("popstate",trackPhoneTime)},bindBooktel:function(){var e=this;if(this.ops.bookTel===true){try{this.book=new kfstouch.component.loupan.Book({id:e.ops.lpid});b("#g-booktel").click(function(f){e.book.getDialog().open()})}catch(d){console.log(d);console.log("电话预定出错了！")}}}}})(Zepto,kfstouch.global.component);APF.Namespace.register("kfstouch.global.component");(function(c,d){var a={listener:{defaults:[]},on:function(h,g,f){var e,i;if(typeof h!=="string"&&typeof h!=="undefined"){return}if(typeof g!=="function"&&typeof f[g]!=="function"){return}e=h||"defaults";i=typeof g==="function"?g:f[g];if(typeof this.listener[e]==="undefined"){this.listener[e]=[]}this.listener[e].push({fn:i,context:f||this})},off:function(m,l,j){var g=m||"defaults",k=this.listener[g],h,f=j||this,e=k?k.length:0;for(h=0;h<e;h++){if(k[h].fn===l&&k[h].context===f){k.splice(h,1)}}},trigger:function(k,g){var f=k||"defaults",j=this.listener[f],h,e=j?j.length:0;for(h=0;h<e;h++){j[h].fn.call(j[h].context,g)}}};function b(e){c.extend(true,e,a)}d.Dialog=function(e){var f={clazz:"g-d-dialog"};this.ops=c.extend(f,e);this.dom={};b(this);this.init()};d.Dialog.prototype={constructor:d.Dialog,init:function(){var f=c(document.createDocumentFragment()),h=this,e,g=c("<div></div>");g.addClass(this.ops.clazz);f.append(g);e=c(this.ops.select);g.append(e);c("body").append(f);this.dom.dialog=g;this.dom.dialog.on("touchmove",function(i){i.preventDefault()});c(this.ops.closeSelect).click(function(i){h.trigger("dialogClose");h.close()});g.find("input").blur(function(i){h.fixDrawSlow()})},open:function(e){this.trigger("open",e);this.dom.dialog.css("display","-webkit-box");this.trigger("afteropen")},close:function(e){this.dom.dialog.hide();this.trigger("close",e)},getDialog:function(){return this.dom.dialog},fixDrawSlow:function(){var e=c(window).scrollTop();setTimeout(function(){c(window).scrollTop(e+1);setTimeout(function(){c(window).scrollTop(e)},10)},1)},}})(Zepto,kfstouch.global.component);APF.Namespace.register("kfstouch.component.loupan");(function(c,b,a){b.Book=function(d){this.ops={};c.extend(this.ops,b.Book.Config,d||{});this.init()};b.Book.prototype={constructor:b.Book,init:function(){this.dialog=new a({select:"#lpb-dialog",closeSelect:"#lpb-close"});this.dialog.on("open",this.openDialog,this);this.dialog.on("dialogClose",function(){T.trackEvent("track_freeback_close")});this.bindForm();this.bindSelectTime();this.bindConfirm();this.timer=null},openDialog:function(){c("#lpb-dialog").show();T.trackEvent("track_freeback_button");c("#lpb-content").show();c("#lpb-info").hide();c("#lpb-fail").hide();c("#lpb-submit").removeAttr("disabled")},getDialog:function(){return this.dialog},bindSelectTime:function(){c("#lpb-booktime").click(function(d){var e=d.target;if(e.tagName.toLowerCase()!=="span"){return}if(c(e).hasClass("bselected")){return}c(e).siblings().removeClass("bselected");c(e).addClass("bselected")})},bindForm:function(){var d=this;c("#lpb-from").submit(function(e){var m=c(this).find(".tel"),g=c(this).find(".bselected"),j=g.data("index"),i={},l="",k,f=c.trim(m.val()),h;h=d.checkPhone(m);k=c("#lpb-submit");if(h){k.attr("disabled","disabled");i.phone=f;i.type=j;i.loupan_id=d.ops.id;d.sendData(d.ops.reserurl,i,function(p){var n=c.parseJSON(p),o=c("#lpb-title");if(n.status){if(n.type===0){c("#lpb-subtime").html("今日&nbsp;"+g.html())}else{c("#lpb-subtime").html("次日&nbsp;"+g.html())}o.html("预约成功");T.trackEvent("track_freeback_select_day_"+j);c("#lpb-booktel").html(f);c("#lpb-content").hide();c("#lpb-info").show();d.delayCloseDialog()}else{if(n.code===2){if(n.type==1){c("#lpb-subtime").html("今日&nbsp;"+n.time)}else{c("#lpb-subtime").html("次日&nbsp;"+n.time)}o.html("您已经预约过本楼盘了");c("#lpb-content").hide();c("#lpb-booktel").html(f);c("#lpb-info").show();d.delayCloseDialog()}else{if(n.code===3){c("#lpb-close").hide();c("#lpb-content").hide();c("#lpb-fail").show();d.delayCloseDialog()}else{c("#lpb-telhint").html('<i class="error"></i>系统出错了，请刷新重试！');c("#lpb-telhint").show();k.removeAttr("disabled")}}}})}return false})},bindConfirm:function(){var d=this;c("#lpb-fconfirm").click(function(){d.dialog.close()});c("#lpb-confirm").click(function(){d.dialog.close()})},sendData:function(e,f,g){c.post(e,f,function(d){if(typeof g==="function"){g(d)}})},delayCloseDialog:function(){var d=this;clearTimeout(this.timer);this.timer=setTimeout(function(){d.dialog.close()},3000)},checkPhone:function(f){var e=c.trim(f.val()),d=f.next();if(e.length===0){d.html('<i class="error"></i>请输入您的号码');d.show();return false}if(T.checkPhone(e)){d.hide();return true}else{d.html('<i class="error"></i>您输入的号码有误哦，请重新输入！');d.show();return false}}}})(Zepto,kfstouch.component.loupan,kfstouch.global.component.Dialog);