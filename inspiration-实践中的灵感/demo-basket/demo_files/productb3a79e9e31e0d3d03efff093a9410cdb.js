var APF={log:function(a){}};APF.Namespace={register:function(d){var c=d.split(".");var a=window;for(var b=0;b<c.length;b++){if(typeof a[c[b]]=="undefined"){a[c[b]]=new Object()}a=a[c[b]]}}};APF.Utils={getWindowSize:function(){var b=0,a=0;if(typeof(window.innerWidth)=="number"){b=window.innerWidth;a=window.innerHeight}else{if(document.documentElement&&(document.documentElement.clientWidth||document.documentElement.clientHeight)){b=document.documentElement.clientWidth;a=document.documentElement.clientHeight}else{if(document.body&&(document.body.clientWidth||document.body.clientHeight)){b=document.body.clientWidth;a=document.body.clientHeight}}}return{width:b,height:a}},getScroll:function(){var b=0,a=0;if(typeof(window.pageYOffset)=="number"){a=window.pageYOffset;b=window.pageXOffset}else{if(document.body&&(document.body.scrollLeft||document.body.scrollTop)){a=document.body.scrollTop;b=document.body.scrollLeft}else{if(document.documentElement&&(document.documentElement.scrollLeft||document.documentElement.scrollTop)){a=document.documentElement.scrollTop;b=document.documentElement.scrollLeft}}}return{left:b,top:a}},setCookie:function(c,f,a,j,d,h){var b=new Date();b.setTime(b.getTime());if(a){a=a*1000*60*60*24}var g=new Date(b.getTime()+(a));document.cookie=c+"="+escape(f)+((a)?";expires="+g.toGMTString():"")+((j)?";path="+j:"")+((d)?";domain="+d:"")+((h)?";secure":"")},getCookie:function(a){var g=document.cookie.split(";");var b="";var d="";var f="";var c=false;for(i=0;i<g.length;i++){b=g[i].split("=");d=b[0].replace(/^\s+|\s+$/g,"");if(d==a){c=true;if(b.length>1){f=unescape(b[1].replace(/^\s+|\s+$/g,""))}return f;break}b=null;d=""}if(!c){return null}},deleteCookie:function(a,c,b){if(this.getCookie(a)){document.cookie=a+"="+((c)?";path="+c:"")+((b)?";domain="+b:"")+";expires=Thu, 01-Jan-1970 00:00:01 GMT"}},setScrollTop:function(a){if(document.body){document.body.scrollTop=a;if(document.body.scrollTop==0){if(document.documentElement){document.documentElement.scrollTop=a}}}else{if(document.documentElement){document.documentElement.scrollTop=a}}},getScrollTop:function(){return document.body?document.body.scrollTop||document.documentElement.scrollTop:document.documentElement.scrollTop},gotoScrollTop:function(f,d){var b=APF.Utils.getScrollTop(),h=0,g=0;var d=d||1;var f=f||0;var a=b>f?1:0;(function(){b=APF.Utils.getScrollTop();h=a?b-f:f-b;g=a?b-h/15*d:b+1+h/15*d;APF.Utils.setScrollTop(g);if(h<=0||b==APF.Utils.getScrollTop()){return}setTimeout(arguments.callee,10)})()}};APF.Namespace.register("kfstouch.global.component");(function($,C){C.SingleHeader=function(){this.initParams();this.initEvents()};C.SingleHeader.prototype={constructor:C.SingleHeader,initParams:function(){this.d={gGoHome:$("#g-go-home"),gGoBack:$("#g-go-back"),gDoSearch:$("#g-do-search"),gGoHomeMenu:$("#g-go-home-menu"),gGoHomeMain:$("#g-go-home-main"),gGoPCenter:$("#g-go-person-center"),gDoShare:$("#g-do-share"),gDoCollect:$("#g-do-collect"),gDoCollectMenu:$("#g-do-collect-menu")};var options=this.constructor.options||{};this.p={homeUrl:options.homeUrl||"",userCenterUrl:options.userCenterUrl||"",anjukeBaseDomain:options.anjukeBaseDomain||"",};this.od={gDoMenu:$("#g-do-menu")}},initEvents:function(){var _this=this;for(var k in this.d){if(this.d[k].length<1){continue}if(typeof eval("this."+k)=="function"){this.d[k].on("click",$.proxy(eval("this."+k),this))}}this.gDoMenu()},gDoMenu:function(){var _this=this;var menuList=this.od.gDoMenu.children().eq(0);this.od.gDoMenu.on("click",function(e){e.stopPropagation()});this.od.gDoMenu.on("touchstart",function(e){menuList.toggle();e.stopPropagation()});$(document).on("click",function(){menuList.hide()});$(document).on("touchstart",function(){menuList.hide()});menuList.on("click",function(e){e.stopPropagation()});menuList.on("touchstart",function(e){e.stopPropagation()})},gGoHome:function(){window.location.href=this.p.homeUrl},gGoHomeMenu:function(){window.location.href=this.p.homeUrl},gGoHomeMain:function(){window.location.href=this.p.homeUrl},gGoBack:function(){var ref=this.getReferrer();var pattern=this.p.anjukeBaseDomain;var patt=new RegExp(pattern);try{if(patt.exec(ref).index>-1){window.history.back()}else{window.location.href=this.p.homeUrl}}catch(e){window.location.href=this.p.homeUrl}},gGoPCenter:function(){window.location.href=this.p.userCenterUrl},getReferrer:function(){var referrer="";try{referrer=window.top.document.referrer}catch(e){if(window.parent){try{referrer=window.parent.document.referrer}catch(e2){referrer=""}}}if(referrer===""){referrer=document.referrer}return referrer},clearCollected:function(){this.d.gDoCollect.length>0&&this.d.gDoCollect.removeClass("item-collected")},setCollected:function(){this.d.gDoCollect.length>0&&this.d.gDoCollect.addClass("item-collected")},isCollected:function(){return this.d.gDoCollect.length>0&&this.d.gDoCollect.hasClass("item-collected")},on:function(name,type,fun){var _this=this;if(typeof eval("this.d."+name)=="undifend"||eval("this.d."+name).length<1){return}eval("this.d."+name).on(type,function(){fun.call(this,_this);_this.od.gDoMenu.children().eq(0).hide()})}}})(Zepto,kfstouch.global.component);APF.Namespace.register("kfstouch.global.component");(function(a,b){b.GotoTop=function(c){var d={start:0,top:0};this.ops=a.extend(d,c||{});this.ele=a("#c-gotop");this.ele.click(a.proxy(this.goTop,this));a(document).on("touchmove",a.proxy(this.scroll,this));a(window).scroll(a.proxy(this.scroll,this))};b.GotoTop.prototype={constructor:b.GotoTop,scroll:function(){var c=a(window).scrollTop();if(c>this.ops.start){this.ele.show()}else{this.ele.hide()}},show:function(){this.ele.show()},hide:function(){this.ele.hide()},goTop:function(){a(window).scrollTop(this.ops.top);this.hide()}}})(Zepto,kfstouch.global.component);APF.Namespace.register("kfstouch.global.component");(function(a,c){function b(){if(window.devicePixelRatio>=2){b=function(){return 2};return 2}else{b=function(){return window.devicePixelRatio};return window.devicePixelRatio}}c.LazyLoadImg=function(d){var f={min:0,max:-1,select:"img",attr:"data-src"};this.ops={};a.extend(this.ops,f,d);this.init()};c.LazyLoadImg.prototype={constructor:c.LazyLoadImg,init:function(){var f=a(window).scrollTop(),g,h,d;a(window).scroll(a.proxy(this.scroll,this));a(document).on("touchmove",a.proxy(this.scroll,this));g=this.ops.min>f?this.ops.min:f;h=a(window).height();if(this.ops.max==-1){d=h+f}else{d=h+f>=this.ops.max?this.ops.max:h+f}this.refreshImg(g,d)},scroll:function(){var d=a(this.ops.select);max=this.ops.max==-1?a(window).scrollTop()+a(window).height():this.ops.max;this.refreshImg(this.ops.min,max)},refreshImg:function(g,d){var k=this,f,h,j;h=this.ops.select.replace(".","");a(this.ops.select).each(function(l,m){j=a(m).offset().top;if(j>g&&j<=d){k.imgReplace(a(m),k.ops.attr);a(m).removeClass(h)}})},imgReplace:function(j,m){var n=m||"data-src",f=j.attr(n),g,o,l,d,k;if(!f){return}g=f.split("/").pop().match(/\d+x\d+/g);if(g){o=parseInt(j.width());l=parseInt(j.height());if(window.devicePixelRatio&&window.devicePixelRatio!=1){d=b();o=parseInt(o*d);l=parseInt(l*d)}f=f.replace(g,o+"x"+l)}if(f){k=new Image();k.onerror=function(h){j.removeAttr("data-src");return false};k.onload=function(){j.attr("src",f)};k.src=f}}}})(Zepto,kfstouch.global.component);APF.Namespace.register("kfstouch.global.component");(function(a,b){b.GlobalFooter=function(){this.initEvents()};b.GlobalFooter.prototype={constructor:b.GlobalFooter,initEvents:function(){a("#history_link").on("click",function(d){var c="xinfang";location.href="/history/"+c});a("#pcPage").on(function(){e.stopPropagation();T.trackEvent("track_home_www_anjuke");setTimeout(function(){window.location.href=pc.attr("href")},500)})}}})(Zepto,kfstouch.global.component);APF.Namespace.register("kfstouch.global.plugin");(function(b,a){a.Share=function(g){var c=this.constructor.options||{};g=g||{};var f=c.doms||g.doms||"";this.doms=b(f);var d=c.box||g.box||"";this.box=b(d);this.localUrl=g.localUrl||window.location.href;this.title=g.title||document.title;this.desc=g.desc||"";this.picUrl=g.picUrl||"";this.host=window.location.host;if(this.box.length>0){this.listener();return}};a.Share.prototype={constructor:a.Share,setLocalUrl:function(c){this.localUrl=c||window.location.href},setTitle:function(c){this.title=c||document.title},setDesc:function(c){this.desc=c||""},setPicUrl:function(c){this.picUrl=c||""},show:function(){this.box.length>0&&this.box.show()},hide:function(c){this.box.length>0&&this.box.hide()},listener:function(){var c=this;if(this.doms.length<1){console.log("无法启动收藏");return false}this.doms.on("click",function(f){var d=b(this).data("fun");c[d](b(this))})},buildUrl:function(f,g){var d=[];for(var c in g){d.push(c+"="+encodeURI(g[c]))}return f+"?"+d.join("&")},copyBtn:function(c){return false},tsina:function(){var c="http://service.weibo.com/share/share.php";var d={title:this.title,url:this.localUrl,source:"bookmark",pic:this.picUrl,appkey:"appkey",ralateUid:""};window.open(this.buildUrl(c,d))},renren:function(){var c="http://widget.renren.com/dialog/share";var d={resourceUrl:this.localUrl,srcUrl:this.localUrl,title:this.title,pic:this.picUrl,description:this.desc};window.open(this.buildUrl(c,d))},qzone:function(){var c="http://sns.qzone.qq.com/cgi-bin/qzshare/cgi_qzshare_onekey";var d={url:this.localUrl,title:this.title,pics:this.picUrl,summary:this.desc};window.open(this.buildUrl(c,d))},tqq:function(){var c="http://share.v.t.qq.com/index.php";var d={c:"share",a:"index",title:this.title,url:this.localUrl,appkey:"appkey",site:this.host,pic:this.picUrl};window.open(this.buildUrl(c,d))}}})(Zepto,kfstouch.global.plugin);APF.Namespace.register("kfstouch.global.component");(function(a,b){b.Search=function(c){this.initParams(c);this.initEvent()};b.Search.prototype={constructor:b.Search,initParams:function(c){this.dom={searchTxt:a("#c-searchtxt"),search:a("#c-search"),history:a("#c-history"),searchCc:a("#c-searchcancel"),result:a("#c-result"),searchForm:a("#c-searchform"),searchInfo:a("#c-search-info")};this.localStorageSupport=typeof localStorage==="object"?true:false;this.storageKey="xinPan";if(typeof c.storageKey=="string"&&c.storageKey!=""){this.storageKey=c.storageKey}this.ops={url:c.url||window.location.href,suggestUrl:c.suggesturl||window.location.href,clickDom:c.clickDom&&a(c.clickDom).length>0?a(c.clickDom):null,showSearch:typeof c.showSearch=="function"?c.showSearch:function(){},hideSearch:typeof c.hideSearch=="function"?c.hideSearch:function(){},redirectEvent:typeof c.redirectEvent=="function"?c.redirectEvent:null};if(typeof this.ops.redirectEvent=="function"){this.redirectEvent=this.ops.redirectEvent}this.hrefReplace=c.hrefReplace||false},setStorageInfo:function(){this.dom.searchInfo.data("storagekey",this.storageKey)},resetStorageInfo:function(){this.dom.searchInfo.data("storagekey","")},getStorageInfo:function(){return this.dom.searchInfo.data("storagekey")},checkStorageInfo:function(){return this.getStorageInfo()!=this.storageKey},redirect:function(c){if(this.checkStorageInfo()){return}this.storageHistory(c);this.dom.searchForm.focus();this.dom.searchTxt.blur();this.resetStorageInfo();this.redirectEvent(c)},redirectEvent:function(h){var d=this.ops.url.indexOf("?"),g,f=[],c,j=d<0?this.ops.url:this.ops.url.substring(0,d);if(d>0){c=this.ops.url.substring(d).replace("?","").split("&");for(g in c){if(c[g].indexOf("q=")===0||c[g]===""){continue}f.push(c[g])}}f.push("q="+h);if(this.hrefReplace===true){location.replace(j+"?"+f.join("&"));return}location.href=j+"?"+f.join("&")},storageHistory:function(f){var g,d,c=[];if(this.localStorageSupport){g=localStorage.getItem(this.storageKey);if(typeof g==="string"){c=g.split(",");d=a.inArray(f,c);if(d===-1){if(c.length>=10){c.shift()}c.push(f)}else{c.splice(d,1);c.push(f)}localStorage.removeItem(this.storageKey);localStorage.setItem(this.storageKey,c.join(","))}else{localStorage.setItem(this.storageKey,f)}}},getSuggest:function(c){var d=this;a.ajax({url:d.ops.suggestUrl,type:"get",dataType:"json",data:{q:c},success:function(g){var f=a.trim(d.dom.searchTxt.val());if(f==c){d.renderResult(g)}}})},encodeHtml:function(d){var c="";if(d.length==0){return""}c=d.replace(/&/g,"&gt;");c=c.replace(/</g,"&lt;");c=c.replace(/>/g,"&gt;");c=c.replace(/ /g,"&nbsp;");c=c.replace(/\'/g,"&#39;");c=c.replace(/\"/g,"&quot;");return c},renderResult:function(d){var c=[];if(!a.isArray(d)){return}a.each(d,function(f,g){c.push('<span data-key="'+g.name+'">'+g.nameEm+"</span>")});this.dom.result.html("");this.dom.result.append(c.join(""))},showSearch:function(){this.setStorageInfo();this.buildHistory();this.dom.search.show();this.dom.searchTxt.val("");this.dom.searchTxt.focus();this.ops.showSearch()},hideSearch:function(){this.ops.hideSearch();this.dom.searchTxt.val("");this.dom.search.hide()},buildHistory:function(){if(!this.localStorageSupport){return}var c,f,g=[],d;this.dom.history.html("");c=localStorage.getItem(this.storageKey);if(typeof c!=="string"){return}d=c.split(",");for(f=d.length-1;f>=0;f--){d[f]=d[f].replace(/(^\s+)|(\s+$)/g,"");if(d[f]!=""){g.push("<span>"+d[f]+"</span>")}}this.dom.history.append(g.join(""))},keyup:function(d){if(d.checkStorageInfo()){return}var c=a(this).val();d.dom.result.hide();if(a.trim(c).length===0){d.buildHistory();d.dom.history.show();return}d.dom.history.hide();d.dom.result.show();d.getSuggest(a.trim(c))},initEvent:function(){var c=this;this.dom.searchTxt.on("keyup",function(){c.keyup.call(this,c)});this.dom.searchTxt.on("input",function(){c.keyup.call(this,c)});this.dom.searchTxt.on("focus",function(){c.keyup.call(this,c)});this.dom.searchCc.click(function(){c.hideSearch()});this.dom.history.on("click","span",function(d){d.stopPropagation();c.redirect(a.trim(a(d.target).html()))});this.dom.result.on("click","span",function(d){d.stopPropagation();var f;if(d.target.tagName.toUpperCase()==="STRONG"){f=a(d.target).parent()}else{f=a(d.target)}c.redirect(a.trim(f.data("key")));c.hideSearch()});this.dom.searchForm.on("submit",function(){var d=a.trim(c.dom.searchTxt.val());if(d.length<=0){return}c.redirect(c.encodeHtml(d));return false});if(this.ops.clickDom){this.ops.clickDom.on("click",function(){c.showSearch()})}}}})(Zepto,kfstouch.global.component);(function(w){var T={},info=J.site.info,cityAlias=info.cityAlias||"sh",head=document.head||document.getElementsByTagName("head")[0],pageName=head.getAttribute("data-page");function trackEvent(page,customparam){if(head.getAttribute("data-flow")=="new"){if(!customparam){var params={}}else{var params=eval("("+customparam+")")}params["new"]="1";customparam=JSON.stringify(params)}J.logger.trackEvent({site:"m_anjuke-npv",page:page,customparam:customparam})}function replaceImg(v,attrName,watermark){attrName=attrName?attrName:"data-src";watermark=watermark===false?false:true;var s=v.getAttribute(attrName);if(s!=""&&s!=null){var re=s.split("/").pop().match(/\d+x\d+/g);if(re){var w=parseInt(v.clientWidth),h=parseInt(v.clientHeight),ratio=0,suffix="";if(window.devicePixelRatio&&window.devicePixelRatio!=1){w=parseInt(w*window.devicePixelRatio);h=parseInt(h*window.devicePixelRatio)}if(!watermark){if(w>220||h>220){var wRatio=w/220,hRatio=h/220,ratio=wRatio>hRatio?wRatio:hRatio;ratio=Math.ceil(ratio);w=Math.floor(w/ratio);h=Math.floor(h/ratio)}if(ratio!==0){s=s.replace(/(\.\w+)$/g,"@"+ratio+"x$1")}}size=w+"x"+h;if(w&&h){s=s.replace(re,w+"x"+h)}}var pic=new Image();pic.src=s;pic.onerror=function(e){v.setAttribute(attrName,"");return false};pic.onload=function(){v.setAttribute("src",s);v.setAttribute(attrName,"")}}}function checkPhone(val){var telpattern=/^1[3|5|7|8][0-9]\d{8}$/;if(typeof val!=="string"&&typeof val!=="number"){return false}if(telpattern.test(val)){return true}else{return false}}function touchClick(selector){var status=true;$(document).on("touchmove",function(){if(status){document.addEventListener("click",preventDefault,true);status=false}});$(document).on("touchend",function(){document.removeEventListener("click",preventDefault,true);status=true})}function preventDefault(event){event.preventDefault()}J.mix(T,{trackEvent:trackEvent,replaceImg:replaceImg,checkPhone:checkPhone,touchClick:touchClick});w.T=T})(J.W);